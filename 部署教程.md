# REALME 心理年龄测试系统部署教程 (Ubuntu Server)

本教程详细说明了如何将本项目部署到 Ubuntu 生产服务器，并配合 Nginx 进行反向代理。

## 一、 环境准备

在服务器上安装必要的环境：

```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装 Node.js (推荐 v18+)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装 Nginx 和 PM2 (用于守护进程)
sudo apt install nginx -y
sudo npm install pm2 -g
```

## 二、 前端打包与部署

1. **本地打包**：
   在开发机或服务器执行：
   ```bash
   cd frontend
   npm install
   npm run build
   ```

2. **部署文件**：
   打包完成后，会生成 `dist` 目录。将该目录内容上传至服务器 `/var/www/realme/html`。

## 三、 后端服务部署

1. **配置后端**：
   将 `backend` 目录上传至服务器 `/var/www/realme/backend`。

2. **安装依赖并启动**：
   ```bash
   cd /var/www/realme/backend
   npm install

   # 使用 PM2 启动服务
   pm2 start realme-api-server.js --name "realme-api"
   pm2 save
   pm2 startup
   ```

3. **权限设置**：
   确保数据存储目录具有写入权限：
   ```bash
   sudo chown -R $USER:$USER /var/www/realme/
   ```

## 四、 Nginx 配置

1. **创建配置文件**：
   `sudo nano /etc/nginx/sites-available/realme`

2. **写入以下配置**：
   ```nginx
   server {
       listen 80;
       server_name your_domain.com; # 替换为您的域名或 IP

       # 前端静态资源路径
       root /var/www/realme/html;
       index index.html;

       # 处理 Vue 路由 (History 模式)
       location / {
           try_files $uri $uri/ /index.html;
       }

       # 代理 API 请求到 Node.js 后端
       location /api {
           proxy_pass http://127.0.0.1:2501; # 后端默认端口
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       }

       # 禁止访问敏感数据目录
       location /data {
           deny all;
       }
   }
   ```

3. **启用配置并重启**：
   ```bash
   sudo ln -s /etc/nginx/sites-available/realme /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl restart nginx
   ```

## 五、 注意事项

- **数据持久化**：生产环境的卡密保存在 `frontend/data/cards.json`。请定期备份此文件。
- **管理员账号**：修改 `backend/config.json` 中的用户名和密码，修改后需执行 `pm2 restart realme-api`。
- **端口冲突**：如果 2501 端口被占用，请在 `realme-api-server.js` 中修改端口。
